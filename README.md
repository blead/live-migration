# Live Migration
This repository is about container live migration across cloud provider using page server. This repo include terraform/ansible and other scripts for setting up live migration environtment and process.

## Prerequisites

- [Terraform](https://www.terraform.io/downloads.html)
- [Ansible](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html)


# How to use make file
This make file created for automating the migration process and make it easy to use.
## entrypoint.sh
This file keep environment variable for running makefile script
- INFRA_DIR => Directory which contain terraform script for provision cloud components
- HOST_FILE => Directory of hosts file which generated by terraform
- SOURCE_IP => Public IP of source machine
- DEST_IP => Public IP of destination machine



The format of using make file is
```sh
entrypoing.sh make <command>
```

## Infrastructure
First, you need to edit `INFRA_DIR` in `entrypoint.sh` to use proper environment.

To setup infrastructure, run `entrypoint.sh make infra`. See in `INFRA_DIR/hosts` and take public ip of source and destination machine and put in `entrypoint.sh`.

## VPN
Run `entrypoint.sh make vpn`

## Install prerequisite packages on host
Run `entrypoint.sh make host`

## Setup containers
- Run `entrypoint.sh make container`
- To check if container is running,un `runc list` on each host.

## Migration process
There are several methods of migration.
1. Normal Migration => `entrypoint.sh make migrate`
2. Pre-copy Migration => `entrypoint.sh make migrate-pre-copy`
3. Migration with Page Server => `entrypoint.sh make migrate-page-server`
4. Pre-copy Migration combined with Page Server => `entrypoint.sh make migrate-pc-ps`


## To reset environment
Run `entrypoint.sh make reset`

## Sections
For more informations, check out README of each part.
- [Infrastructure](infrastructure)
- [IPsec VPN](ipsec-vpn)
- [Migration Host](migration-host)
- [OCI Container](oci-container)
- [Process Migration](process-migration)
- [Reset Environment](reset-environment)